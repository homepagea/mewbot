Moment = require 'moment'

ignored_functions=["start","stop","afterConfigUpdate"]

class MewService
    constructor : (@serviceName,@mew,@config)->

    start : (callback)->
        callback()

    ping : (callback)->
        response = {
            status : "NORMAL",
            name : @mew.name,
            time : (new Moment()).format()
        }
        callback(null,response)

    stop : (callback)->
        if callback
            callback()

    afterConfigUpdate : (callback)->
        @mew.logger.debug "configure for service [#{@serviceName}] update complete"
        callback()

    configure : (key,value,callback)->
        if typeof key is 'function'
            callback = key
            return callback(null,@config)
        else
            if key
                if typeof value is 'function'
                    callback = value
                    return callback(null,@config[key])
                else if value
                    @config[key]=value
                else
                    delete @config[key]
                @mew.brain.serviceManager.persistConfig @serviceName,(err)=>
                    if err
                        callback(Err)
                    else
                        try
                            @afterConfigUpdate (err)=>
                                if err
                                    callback(err)
                                else
                                    callback(null,@config)
                        catch ex
                            callback(ex)
            else
                callback("illegal argument")


module.exports=MewService
module.exports.ignored_functions=ignored_functions
