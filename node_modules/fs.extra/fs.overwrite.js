(function () {
  "use strict";

  var fs = require('fs')
    ;
  var checkPermission = function (stats, mask){
    return !!(mask & parseInt ((stats.mode & parseInt ("777", 8)).toString (8)[0]));
  };
  function noop() {}


  function overwrite(src, dst, cb) {
    function copyHelper(err) {
      var is
        , os
        ;
      fs.stat(src, function (err, stat) {
        if (err) {
          return cb(err);
        }

        is = fs.createReadStream(src);
        os = fs.createWriteStream(dst);

        is.pipe(os);
        os.on('close', function (err) {
          if (err) {
            return cb(err);
          }
          if(checkPermission(stat,1)){
            fs.chmod(dst,stat.mode,function(err){
              if(err){
                return cb(err);
              }else{
                fs.utimes(dst, stat.atime, stat.mtime, cb);
              }
           });
          }else{
            fs.utimes(dst, stat.atime, stat.mtime, cb);
          }
        });
      });
    }

    cb = cb || noop;
    fs.stat(dst, copyHelper);
  }

  module.exports = overwrite;
}());
